# 🏗️ Архитектура CS2 Analytics

```
┌─────────────────────────────────────────────────────────────────┐
│                    📱 МОБИЛЬНОЕ ПРИЛОЖЕНИЕ                       │
│                    (React Native + Expo)                         │
│                                                                   │
│  ┌─────────────────┐         ┌──────────────────┐               │
│  │  app/index.tsx  │         │ app/match/[id]   │               │
│  │                 │         │                  │               │
│  │  • Live матчи   │────────▶│  • AI анализ     │               │
│  │  • Upcoming     │         │  • Статистика    │               │
│  │  • Filters      │         │  • Прогнозы      │               │
│  └─────────────────┘         └──────────────────┘               │
│           │                            │                         │
│           │                            │                         │
│           └────────────┬───────────────┘                         │
│                        │                                         │
│                        ▼                                         │
│              ┌──────────────────┐                                │
│              │  constants/      │                                │
│              │  api.ts          │                                │
│              │                  │                                │
│              │  API_BASE_URL    │                                │
│              └──────────────────┘                                │
└───────────────────────┬─────────────────────────────────────────┘
                        │
                        │ HTTP Requests
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────┐
│                     🌐 RENDER.COM                                │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              🔧 BACKEND SERVER (Node.js)                 │   │
│  │                                                          │   │
│  │  ┌────────────────────────────────────────────────┐     │   │
│  │  │         📡 API Routes (Express)                │     │   │
│  │  │                                                │     │   │
│  │  │  GET  /api/matches                            │     │   │
│  │  │  GET  /api/matches/:id                        │     │   │
│  │  │  POST /api/matches/:id/analyze                │     │   │
│  │  │  GET  /health                                 │     │   │
│  │  └────────────────────────────────────────────────┘     │   │
│  │                      │                                   │   │
│  │                      ▼                                   │   │
│  │  ┌────────────────────────────────────────────────┐     │   │
│  │  │         🧠 Services                            │     │   │
│  │  │                                                │     │   │
│  │  │  • MatchAnalyzer (AI прогнозы)                │     │   │
│  │  │  • CacheService (2-10 мин TTL)                │     │   │
│  │  └────────────────────────────────────────────────┘     │   │
│  │                      │                                   │   │
│  │                      ▼                                   │   │
│  │  ┌────────────────────────────────────────────────┐     │   │
│  │  │         🕷️ Scrapers                           │     │   │
│  │  │                                                │     │   │
│  │  │  • HLTVScraper (матчи, команды)               │     │   │
│  │  │  • LiquidpediaScraper (игроки, карты)         │     │   │
│  │  └────────────────────────────────────────────────┘     │   │
│  │            │                        │                   │   │
│  │            ▼                        ▼                   │   │
│  │  ┌─────────────────┐    ┌─────────────────┐            │   │
│  │  │  Browserless    │    │   ScraperAPI    │            │   │
│  │  │  API Client     │    │   API Client    │            │   │
│  │  └─────────────────┘    └─────────────────┘            │   │
│  └──────────────────────────────────────────────────────────┘   │
└───────────────────────┬──────────┬──────────────────────────────┘
                        │          │
          ┌─────────────┘          └──────────────┐
          │                                       │
          ▼                                       ▼
┌─────────────────────┐                ┌──────────────────────┐
│   🌐 HLTV.org       │                │  📚 Liquidpedia      │
│                     │                │                      │
│  • Live матчи       │                │  • Игроки            │
│  • Upcoming         │                │  • Карты             │
│  • Статистика       │                │  • H2H               │
│  • Новости          │                │  • История           │
└─────────────────────┘                └──────────────────────┘


═══════════════════════════════════════════════════════════════════

📊 ПОТОК ДАННЫХ:

1. Пользователь открывает приложение
        ↓
2. Приложение запрашивает данные у backend
   GET https://backend.onrender.com/api/matches
        ↓
3. Backend проверяет кэш
   • Есть в кэше? → возвращает из кэша (быстро!)
   • Нет в кэше? → запускает scraping
        ↓
4. Scraping:
   • HLTVScraper через ScraperAPI → HLTV.org
   • LiquidpediaScraper через Browserless → Liquidpedia
        ↓
5. Парсинг HTML → структурированные данные
        ↓
6. Сохранение в кэш (2-10 минут TTL)
        ↓
7. Возврат JSON в приложение
        ↓
8. Приложение отображает данные с красивым UI

═══════════════════════════════════════════════════════════════════

🔑 API KEYS (уже настроены!):

┌─────────────────────────────────────────────────────────────┐
│  Backend (.env)                                             │
│                                                             │
│  BROWSERLESS_API_KEY=2TO87BeFLtlmUIX274fd6c0a4fab3da...    │
│  SCRAPER_API_KEY=d8a5c9b77c6a7bcdd64582811f9534ce          │
│                                                             │
│  → Копировать в Render.com Environment Variables!          │
└─────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════

⚡ ПРОИЗВОДИТЕЛЬНОСТЬ:

┌──────────────────────┬──────────────┬─────────────────────┐
│ Операция             │ Время        │ Описание            │
├──────────────────────┼──────────────┼─────────────────────┤
│ First request        │ 5-10 сек     │ Scraping + парсинг  │
│ Cached request       │ <100ms       │ Из кэша             │
│ Live updates         │ Каждые 2 мин │ Авто-обновление     │
│ Render.com sleep     │ 15 мин       │ Free tier           │
│ Wake up              │ ~30 сек      │ Cold start          │
└──────────────────────┴──────────────┴─────────────────────┘

═══════════════════════════════════════════════════════════════════

📦 ТЕХНОЛОГИИ:

Frontend:
├── React Native (0.81.5)
├── Expo (SDK 54)
├── TypeScript (5.9.2)
├── Expo Router (файловый роутинг)
└── Lucide Icons

Backend:
├── Node.js (18+)
├── Express (4.18.2)
├── TypeScript (5.3.3)
├── Cheerio (1.0.0) - HTML парсинг
├── Axios (1.6.2) - HTTP клиент
└── Dotenv (16.3.1) - env variables

APIs:
├── Browserless - браузер в облаке
├── ScraperAPI - обход блокировок
├── HLTV - источник данных о матчах
└── Liquidpedia - статистика и история

═══════════════════════════════════════════════════════════════════

🔄 ЖИЗНЕННЫЙ ЦИКЛ ЗАПРОСА:

User Action → Mobile App → API Call → Backend Router
                                           ↓
                                    Check Cache?
                                     ↓         ↓
                                   YES       NO
                                    ↓         ↓
                              Return Cache  Start Scraping
                                    ↓         ↓
                                    ↓    HLTV + Liquidpedia
                                    ↓         ↓
                                    ↓    Parse HTML
                                    ↓         ↓
                                    ↓    Save to Cache
                                    ↓         ↓
                                    └─────────┘
                                         ↓
                                    Return JSON
                                         ↓
                                    Mobile App
                                         ↓
                                   Display UI

═══════════════════════════════════════════════════════════════════
```

## 🎯 Ключевые моменты

1. **Кэширование** - первый запрос медленный, последующие быстрые
2. **Browserless + ScraperAPI** - обход блокировок HLTV
3. **Real-time updates** - данные обновляются каждые 2 минуты
4. **REST API** - простое подключение мобильного приложения
5. **TypeScript** - строгая типизация на всех уровнях

## 🚀 Деплой

```
Local Development          GitHub              Render.com
      ↓                      ↓                      ↓
   npm build    →    git push origin main  →  Auto Deploy
      ↓                      ↓                      ↓
   dist/        →     GitHub Repo         →  Production
```

## 📱 Использование

```
User opens app
     ↓
Sees Live/Upcoming matches
     ↓
Clicks on match
     ↓
Sees detailed stats
     ↓
Clicks "Analyze with AI"
     ↓
Gets AI predictions
```
